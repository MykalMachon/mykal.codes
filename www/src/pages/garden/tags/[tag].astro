---
import { getCollection } from 'astro:content';
import PostList from '../../../components/posts/PostList.astro';
import ContentLayout from '../../../layouts/ContentLayout.astro';
import { getSortedPosts } from '../../../utils/posts';
import { getAllTags, getPostsByTags } from '../../../utils/tags';

export async function getStaticPaths({}) {
  const allPosts = await getCollection('posts');
  const allSortedPosts = getSortedPosts(allPosts);
  const allTags = getAllTags(allSortedPosts);
  const allTagPosts = allTags.map((tag: string) =>
    getPostsByTags(tag, allSortedPosts)
  );

  return allTagPosts.map((tagPosts) => {
    return {
      params: { tag: tagPosts.tag },
      props: { tag: tagPosts.tag, posts: tagPosts.posts },
    };
  });
}

const { tag, posts } = Astro.props;
---

<ContentLayout data={{title: `#${tag}`, description: `a collection of ${posts.length} posts tagged as ${tag}`}}>
  <p>this tag has {posts.length} posts</p>
  <PostList {posts} type={'small'} />
</ContentLayout>
